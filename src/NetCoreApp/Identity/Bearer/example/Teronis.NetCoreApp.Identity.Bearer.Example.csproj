<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
    <TeronisNetCoreAppIdentityBearerPropsPath>$(PackagePublishmentsDirectory)PublishablePackage.NetCoreApp.Identity.Bearer\build\Teronis.NetCoreApp.Identity.Bearer.props</TeronisNetCoreAppIdentityBearerPropsPath>
  </PropertyGroup>

  <!-- Intentionally commented. (see below) -->
  <!--<Import Project="$(TeronisNetCoreAppIdentityBearerPropsPath)" Condition="Exists($(TeronisNetCoreAppIdentityBearerPropsPath))" />-->

  <PropertyGroup>
    <TargetFramework>netcoreapp3.1</TargetFramework>
    <Nullable>enable</Nullable>
    <RootNamespace>Teronis.Identity.Bearer</RootNamespace>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.EntityFrameworkCore.InMemory" Version="3.1.5" />
    <PackageReference Include="Microsoft.EntityFrameworkCore.Sqlite" Version="3.1.5" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\..\..\..\NetStandard\AspNetCore\Authorization\Extensions\src\Teronis.NetStandard.AspNetCore.Authorization.Extensions.csproj" />
    <ProjectReference Include="..\..\Identity\src\Teronis.NetCoreApp.Identity.csproj" />
    <ProjectReference Include="..\src\Teronis.NetCoreApp.Identity.Bearer.csproj" />
    <ProjectReference Include="..\ref\PublishablePackage\PublishablePackage.NetCoreApp.Identity.Bearer.csproj" />
  </ItemGroup>

  <!-- Because the dependency graph will be built once and therefore the import get -->
  <Target Name="CallSetTeronisIdentityBearerModuleInitializerAssemblyLoaderInjectionTargetAssembly" BeforeTargets="BeforeCompile">

    <PropertyGroup>

      <InlinedIntermediateAssembly>@(IntermediateAssembly->'%(FullPath)',';')</InlinedIntermediateAssembly>
      <InlinedIntermediateAssembly>$([MSBuild]::Escape('$(InlinedIntermediateAssembly)'))</InlinedIntermediateAssembly>

      <_MSBuildProperties>
        IntermediateAssembly=$(InlinedIntermediateAssembly)
      </_MSBuildProperties>

    </PropertyGroup>

    <MSBuild Projects="$(TeronisNetCoreAppIdentityBearerPropsPath)" Targets="SetTeronisIdentityBearerModuleInitializerAssemblyLoaderInjectionTargetAssembly"
             Properties="$(_MSBuildProperties)">
      <Output TaskParameter="TargetOutputs" ItemName="ModuleInitializerAssemblyLoaderInjectionTargetAssemblies" />
    </MSBuild>

  </Target>

</Project>
